/* =======================================================================================
   Rhapsody · Files Sidebar · List Mode（文件侧栏 · 列表模式 · 样式包）
   设计理念 / Design Concept
   - 严格“分区自持变量”：A=容器底色/前景/描边；B=交互变量与关键帧；C=搜索；D=滚动条；
     E=字体；F=分隔拖拽条；G=文件右键菜单。各分区仅在自身作用域内取用变量，不跨区。
   - 不改动 DOM 结构（Typora 限制）；只锚定已知 ID/类；大量使用 :is/:where 降低特异性，
     防止样式渗漏并便于后续覆盖与维护。
   - 动画“按需启用”：B 区流动渐变默认暂停，仅在容器 hover 时运行；同时尊重
     prefers-reduced-motion，提供无动画降级。
   - 性能优先：A 区只做“容器级”纯色与描边，交互渐变仅在 B 区出现；避免跨区变量与
     深层级选择器重算；:has() 仅用于 F 区开关（并有 MegaMenu 打开时的显式回退）。
   - 视觉统一：保持 Mirror’s Edge 三色（#ff2a2a / #23b3fc / #ffe232）作为交互层主题色；
     容器层维持纯色基底，确保层次清晰。

   使用说明 / Usage Notes
   - 仅当 #typora-sidebar.active-tab-files.use-file-list-style 存在时激活，不影响树形/大纲/写作区。
   - 可与其它区域样式并行加载；MegaMenu 打开时，F 区分隔条显式还原；G 区用 ul#file-menu
     直锚以适配 Portal（不依赖 :has()）。

   兼容性 / Compatibility
   - 优化于 Chromium/Electron（Typora）；旧内核自动降级为静态底色与无动画。
   - D 区滚动条为 WebKit 私有实现，非 WebKit 内核自动忽略。

   可调参数 / Adjustable Params
   - A：--files-core-bg / --files-core-fg / --files-core-border
   - B：渐变三色/时长、圆角、发光强度、左侧强调线、动画开关
   - C：搜索壳/输入框的底色、前景、描边、圆角、插入符色
   - D：滚动条宽高、圆角、光泽与悬停亮度
   - E：--files-font-ui / --files-font-head / --files-font-code
   - F：分隔条宽度、idle/hover/active 背景与描边阴影
   - G：右键菜单配色、半径、阴影、动效时长与可访问性描边

   QA / Scope Fence
   - 仅命中 Files×List；关键帧命名以 catalystTabFlow--files / --filemenu 前缀避免冲突；
     不向其它区域（B–H 以外）泄露变量或样式。
   ======================================================================================= */

/* ========================================================================== */
/* REGION A — SIDEBAR CORE ROOT（侧边栏核心 · 仅 Files 激活 & 列表模式）       */
/* Scope: #typora-sidebar.active-tab-files.use-file-list-style                 */
/* Function: 定义 Files 列表模式下的“容器级”底色/前景/描边，并应用到常见容器；  */
/*           不再向其它区域（B–H）提供跨区变量。                               */
/* Adjustable Params: --files-core-bg / --files-core-fg / --files-core-border  */
/* Compatibility: Chromium/Electron (Typora)。旧内核退化为静态底色。           */
/* ========================================================================== */
#typora-sidebar.active-tab-files.use-file-list-style{
  /* —— container-only palette —— */
  --files-core-bg: #ff4d4f;                 /* 容器底色 */
  --files-core-fg: #ffffff;                 /* 容器前景（文字） */
  --files-core-border: rgba(255,77,79,.22); /* 细描边 */

  /* 仅 A 区使用：把容器与常见子容器统一为 core 底色/前景/描边 */
  background: var(--files-core-bg);
  color: var(--files-core-fg);
  border-color: var(--files-core-border);
}

/* ========================================================================== */
/* REGION B — SIDEBAR INTERACTABLES（交互项 · Files×列表）                     */
/* Scope: #typora-sidebar.active-tab-files.use-file-list-style                 */
/* Function: 仅定义交互用变量与状态（静态/hover/active 的渐变、发光、圆角等）。  */
/* Adjustable Params: 渐变三色/时长、圆角、发光强度、左侧强调线、动画开关。      */
/* Compatibility: 全现代内核。prefers-reduced-motion 将自动降级。               */
/* ========================================================================== */
#typora-sidebar.active-tab-files.use-file-list-style{
  /* —— B 区专属变量（不跨区） —— */
  --files-int-active-anim: paused;           /* 默认暂停；容器 hover 时再 running */
  --files-int-radius: 8px;                   /* 交互项圆角 */
  --files-int-border: 1px solid transparent; /* 边框 */
  --files-int-stroke: inset 0 0 0 1px rgba(255,77,79,.22);

  --files-grad-1: #ff2a2a;   /* 渐变三色（交互项用） */
  --files-grad-2: #23b3fc;
  --files-grad-3: #ffe232;
  --files-flow-duration: 6s; /* 渐变时长 */

  --files-glow-a: rgba(35,179,252,0.35);     /* 发光（hover） */
  --files-glow-b: rgba(255,42,42,0.25);
  --files-glow-active: rgba(35,179,252,0.45);/* 发光（active） */

  --files-accent: #ff2a2a;                   /* 左侧强调线 */
}
/* 容器 hover 才播放 active 的流动动画 */
#typora-sidebar.active-tab-files.use-file-list-style       { --files-int-active-anim: paused;  }
#typora-sidebar.active-tab-files.use-file-list-style:hover { --files-int-active-anim: running; }

/* 静态态（非 active 且未 hover） */
#typora-sidebar.active-tab-files.use-file-list-style :is(
  .file-list-item,
  .file-library-node > .file-node-background,
  .sidebar-footer-item
):not(.active):not(:hover){
  background: inherit;
  color: inherit;
  border: var(--files-int-border);
  box-shadow: var(--files-int-stroke);
  filter: none;
  border-radius: var(--files-int-radius);
  transition:
    background .25s ease, color .25s ease,
    box-shadow .25s ease, border-color .25s ease, filter .25s ease;
}

/* Hover（仅 hover 才开流动渐变） */
#typora-sidebar.active-tab-files.use-file-list-style :is(
  .info-panel-tab-title:not(.active):hover,
  .file-list-item:not(.active):hover,
  .file-library-node:hover > .file-node-background:not(.active),
  .sidebar-footer-item:hover,
  .footer-item:hover
){
  background: linear-gradient(135deg, var(--files-grad-1), var(--files-grad-2), var(--files-grad-3));
  background-size: 300% 300%;
  animation: catalystTabFlow--files var(--files-flow-duration) ease infinite;
  color: #fff;
  border-color: transparent;
  box-shadow:
    inset 0 0 0 1px rgba(255,77,79,.18),
    0 0 8px var(--files-glow-a),
    0 0 16px var(--files-glow-b);
  border-radius: var(--files-int-radius);
}

/* Active（静态渐变 + 左侧强调线） */
#typora-sidebar.active-tab-files.use-file-list-style :is(
  #info-panel-tab-file,
  .file-list-item.active,
  .file-library-node.active > .file-node-background
){
  background: linear-gradient(135deg, var(--files-grad-2), var(--files-grad-3), var(--files-grad-1));
  background-size: 300% 300%;
  color:#fff; border-color:transparent;
  box-shadow:
    inset 3px 0 0 0 var(--files-accent),
    inset 0 0 0 1px rgba(255,77,79,.18),
    0 0 10px var(--files-glow-active);
  border-radius: var(--files-int-radius);
  animation: catalystTabFlow--files var(--files-flow-duration) ease infinite;
  animation-play-state: var(--files-int-active-anim); /* paused | running */
}

/* Active + Hover（轻提亮） */
#typora-sidebar.active-tab-files.use-file-list-style :is(
  #info-panel-tab-file:hover,
  .file-list-item.active:hover,
  .file-library-node.active > .file-node-background:hover
){
  filter: brightness(1.08);
  border-color: transparent;
  box-shadow:
    inset 3px 0 0 0 var(--files-accent),
    inset 0 0 0 1px rgba(255,77,79,.16),
    0 0 14px rgba(35,179,252,0.55),
    0 0 20px rgba(255,42,42,0.35);
}

/* 关键帧（B 区专属） */
@keyframes catalystTabFlow--files{
  0%{background-position:0% 50%}
  50%{background-position:100% 50%}
  100%{background-position:0% 50%}
}

/* 降动态偏好 */
@media (prefers-reduced-motion: reduce){
  #typora-sidebar.active-tab-files.use-file-list-style :is(
    #info-panel-tab-file,
    .file-list-item.active,
    .file-library-node.active > .file-node-background,
    .info-panel-tab-title:not(.active):hover,
    .file-list-item:not(.active):hover,
    .file-library-node:hover > .file-node-background:not(.active),
    .sidebar-footer-item:hover,
    .footer-item:hover
  ){
    animation:none !important;
    background-position:50% 50%;
  }
}

/* ========================================================================== */
/* REGION C — SEARCH PANEL ROOT（搜索区 root · Files×列表）                    */
/* Scope: #typora-sidebar.active-tab-files.use-file-list-style #file-library-search-panel */
/* Function: 搜索壳与输入框的底色/前景/描边/圆角，仅本区变量。                   */
/* Adjustable Params: shell 边框、输入框底色/文字/描边/圆角/插入符色。           */
/* Compatibility: 现代内核。                                                   */
/* ========================================================================== */
#typora-sidebar.active-tab-files.use-file-list-style{
  /* —— C 区专属变量 —— */
  --files-search-shell-border: 1px solid rgba(255,77,79,.22);
  --files-search-input-bg: #ecafaf;
  --files-search-input-fg: #ab0bf4;
  --files-search-input-border: 1px solid rgba(0,0,0,.12);
  --files-search-input-radius: 6px;
}
#typora-sidebar.active-tab-files.use-file-list-style #file-library-search-panel{
  border: var(--files-search-shell-border);
  box-shadow:none;
  background: inherit;
  border-radius: 8px;
}
#typora-sidebar.active-tab-files.use-file-list-style #file-library-search-panel input[type="search"]{
  background: var(--files-search-input-bg);
  color: var(--files-search-input-fg);
  border: var(--files-search-input-border);
  outline: none;
  border-radius: var(--files-search-input-radius);
  padding: 6px 10px;
  caret-color: var(--files-search-input-fg);
}

/* ========================================================================== */
/* REGION D — SCROLLBAR ROOT（琉璃蓝 · 仅 Files 侧栏内部）                      */
/* Scope: #typora-sidebar.active-tab-files.use-file-list-style 内部滚动容器      */
/* Function: 侧栏内部滚动条的拇指/轨道外观（不影响主视口/其他滚动容器）。          */
/* Adjustable Params: 三色、光泽、阴影、宽高、圆角、悬停亮度。                     */
/* Compatibility: WebKit 滚动条。非 WebKit 内核自动忽略。                        */
/* ========================================================================== */

#typora-sidebar.active-tab-files.use-file-list-style *::-webkit-scrollbar{
  width:12px; height:12px; background:transparent;
}
#typora-sidebar.active-tab-files.use-file-list-style *::-webkit-scrollbar-track{
  background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.03));
  border-radius:10px;
}
#typora-sidebar.active-tab-files.use-file-list-style *::-webkit-scrollbar-thumb{
  border-radius:10px; border:1px solid rgba(255,255,255,.18);
  background-image: linear-gradient(180deg, #9cecff, #40b8ff 40%, #0a6ed1);
  background-size:200% 200%;
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,.72),
    inset 0 -1px 0 rgba(0,0,0,.35),
    0 0 0 1px rgba(255,255,255,.10),
    0 0 12px rgba(64,184,255,.42);
  transition: filter .18s ease, box-shadow .18s ease, background-position .6s ease;
}
#typora-sidebar.active-tab-files.use-file-list-style *::-webkit-scrollbar-thumb:horizontal{
  background-image: linear-gradient(90deg, #9cecff, #40b8ff 40%, #0a6ed1);
}
#typora-sidebar.active-tab-files.use-file-list-style *::-webkit-scrollbar-thumb:hover{
  filter: brightness(1.08) saturate(1.15);
  background-position: 100% 50%;
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,.72),
    inset 0 -1px 0 rgba(0,0,0,.40),
    0 0 0 1px rgba(255,255,255,.14),
    0 0 16px rgba(64,184,255,.42);
}
#typora-sidebar.active-tab-files.use-file-list-style *::-webkit-scrollbar-corner{
  background:transparent;
}
@media (prefers-reduced-motion: reduce){
  #typora-sidebar.active-tab-files.use-file-list-style *::-webkit-scrollbar-thumb{
    transition:none; background-position:50% 50%;
  }
}

/* ========================================================================== */
/* REGION E — FONT ROOT（字体设置 · 仅 Files 侧栏）                             */
/* Scope: #typora-sidebar.active-tab-files.use-file-list-style 内部文字         */
/* Function: 侧栏 UI/标题/代码的字体家族（本区独立变量，不跨区）。               */
/* Adjustable Params: --files-font-ui / --files-font-head / --files-font-code。  */
/* Compatibility: 现代内核。                                                   */
/* ========================================================================== */
/* 变量保持不变 */
#typora-sidebar.active-tab-files.use-file-list-style{
  --files-font-ui: 'AliPuHuiTi','Microsoft YaHei',sans-serif;
  --files-font-code:'JetBrainsMonoNL','RobotoMono',monospace;
  --files-font-head:'GuDuYanHei','AliPuHuiTi',sans-serif;
}

/* ① UI 基础字体（降特异性版本） */
#typora-sidebar.active-tab-files.use-file-list-style,
#typora-sidebar.active-tab-files.use-file-list-style :where(
  .sidebar, #sidebar, #sidebar-content, .sidebar-content,
  #file-library, #file-library-list, .file-list, .file-tree,
  .info-panel-tab-title-group, .info-panel-tab-title,
  .file-list-item, .file-library-node, .sidebar-footer, .sidebar-menu
){
  font-family: var(--files-font-ui);
}

/* ② 标题用 Head 字体（会自然覆盖 ①） */
#typora-sidebar.active-tab-files.use-file-list-style :is(.info-panel-tab-title-group, .info-panel-tab-title){
  font-family: var(--files-font-head);
}

/* ③ 代码用等宽字体（会自然覆盖 ①） */
#typora-sidebar.active-tab-files.use-file-list-style code{
  font-family: var(--files-font-code);
}

/* ========================================================================== */
/* REGION F — RESIZER BAR（分隔拖拽条 · Files×列表×非 MegaMenu）                */
/* Scope: （推荐）#typora-sidebar ~ .typora-sidebar-resizer-bar                 */
/* Function: 分隔条的宽度/颜色/悬停与拖动态（本区独立变量）。                     */
/* Adjustable Params: 宽度、idle/hover/active 背景、描边阴影。                    */
/* Compatibility: 现代内核。MegaMenu 打开时回退为主题默认。                      */
/* ========================================================================== */

body:not(.megamenu-opened):has(#typora-sidebar.active-tab-files.use-file-list-style){
  --files-resizer-w: 8px;
  --files-resizer-bg: #ff4d4f;
  --files-resizer-hover: #ff5f61;
  --files-resizer-active: #ff2a2a;
  --files-resizer-shadow: 0 0 0 1px rgba(255,77,79,.22);
}

body:not(.megamenu-opened):has(#typora-sidebar.active-tab-files.use-file-list-style)
  .typora-sidebar-resizer-bar{
  width: var(--files-resizer-w);
  background: var(--files-resizer-bg);
  box-shadow: var(--files-resizer-shadow);
  cursor: col-resize;
  transition: background .18s ease, box-shadow .18s ease;
}

body:not(.megamenu-opened):has(#typora-sidebar.active-tab-files.use-file-list-style)
  .typora-sidebar-resizer-bar:hover{
  background: var(--files-resizer-hover);
  box-shadow: 0 0 0 1px rgba(255,77,79,.30);
}

body:not(.megamenu-opened):has(#typora-sidebar.active-tab-files.use-file-list-style)
  .typora-sidebar-resizer-bar:active,
body:not(.megamenu-opened):has(#typora-sidebar.active-tab-files.use-file-list-style)
  .typora-sidebar-resizer-bar.dragging{
  background: var(--files-resizer-hover);
  box-shadow: inset 0 0 0 2px var(--files-resizer-active),
              0 0 10px rgba(255,42,42,.35);
}

@media (prefers-reduced-motion: reduce){
  body:not(.megamenu-opened):has(#typora-sidebar.active-tab-files.use-file-list-style)
    .typora-sidebar-resizer-bar{ transition:none; }
}

/* MegaMenu 打开时显式还原 */
body.megamenu-opened .typora-sidebar-resizer-bar{
  background: initial;
  box-shadow: none;
}

/* ========================================================================== */
/* REGION G — FILE CONTEXT MENU（电紫 · 仅右键菜单）                             */
/* Scope: ul#file-menu.dropdown-menu.context-menu.ext-context-menu（右键弹出）   */
/* Function: 右键文件菜单外观与交互（本区自带变量；不影响底部菜单等其它入口）。     */
/* Notes: 不使用 :has；菜单可能通过 Portal 挂在 body，下列选择器已直接锚定 ID。     */
/* ========================================================================== */
/* ===== Files×List 专用右键菜单（Portal 安全，使用 :has 守门） =============== */
@supports selector(:has(*)) {

  /* 主容器（只有 List 激活时命中） */
  body:has(#typora-sidebar.active-tab-files.use-file-list-style)
  ul#file-menu.dropdown-menu.context-menu.ext-context-menu{
    /* —— G 区专属变量：Starry Purple —— */
    --fm-bg:#3a0a5c; --fm-fg:#fff; --fm-border:rgba(212,0,255,.28);
    --fm-radius:10px; --fm-shadow:0 10px 24px rgba(0,0,0,.35);
    --fm-grad-1:#d400ff; --fm-grad-2:#7c4dff; --fm-grad-3:#ff6ec7;
    --fm-flow-duration:6s;
    --fm-glow-a:rgba(124,77,255,.38); --fm-glow-b:rgba(212,0,255,.30);
    --fm-item-radius:8px; --fm-item-stroke:inset 0 0 0 1px rgba(255,255,255,.14);
    --fm-item-pad-y:.48rem; --fm-item-pad-x:1rem;
    --fm-font-ui:'AliPuHuiTi','Microsoft YaHei',sans-serif;
    --fm-shortcut-fg:rgba(255,255,255,.85);
    --fm-divider:rgba(255,255,255,.22); --fm-disabled-fg:rgba(255,255,255,.55);
    --fm-focus-ring:#b388ff;

    font-family: var(--fm-font-ui);
    background: var(--fm-bg); color: var(--fm-fg);
    border:1px solid var(--fm-border); border-radius:var(--fm-radius);
    box-shadow:var(--fm-shadow); padding:.38rem 0; min-width:188px; z-index:9999;
    overflow:visible; isolation:isolate;
  }

  /* 分组标题 */
  body:has(#typora-sidebar.active-tab-files.use-file-list-style)
  ul#file-menu li.menuitem-group-label{
    padding:.42rem var(--fm-item-pad-x);
    margin:.15rem 0 .25rem;
    font-weight:700; opacity:.95;
  }

  /* 菜单项（默认态） */
  body:has(#typora-sidebar.active-tab-files.use-file-list-style)
  ul#file-menu li > a[role="menuitem"]{
    display:block; padding:var(--fm-item-pad-y) var(--fm-item-pad-x);
    color:var(--fm-fg); text-decoration:none; border-radius:var(--fm-item-radius);
    background:var(--fm-bg); box-shadow:var(--fm-item-stroke);
    transition: background .25s ease, color .25s ease, box-shadow .25s ease, filter .25s ease;
  }

  /* Hover（仅可悬停设备 & 非禁用项） */
  @media (hover:hover){
    body:has(#typora-sidebar.active-tab-files.use-file-list-style)
    ul#file-menu li > a[role="menuitem"]:not([aria-disabled="true"]):hover{
      background: linear-gradient(135deg, var(--fm-grad-1), var(--fm-grad-2), var(--fm-grad-3));
      background-size:300% 300%;
      animation: catalystTabFlow--filemenu var(--fm-flow-duration) ease infinite;
      color:#fff;
      box-shadow:
        inset 0 0 0 1px rgba(255,255,255,.12),
        0 0 10px var(--fm-glow-a),
        0 0 18px var(--fm-glow-b);
    }
  }

  /* Active（如有 .active） */
  body:has(#typora-sidebar.active-tab-files.use-file-list-style)
  ul#file-menu li.active > a[role="menuitem"]{
    background: linear-gradient(135deg, var(--fm-grad-2), var(--fm-grad-3), var(--fm-grad-1));
    background-size:300% 300%; color:#fff;
    box-shadow: inset 0 0 0 1px rgba(255,255,255,.12),
                0 0 12px rgba(124,77,255,.50);
  }

  /* Disabled（语义化禁用，并停动画） */
  body:has(#typora-sidebar.active-tab-files.use-file-list-style)
  ul#file-menu li > a[role="menuitem"][aria-disabled="true"]{
    color: var(--fm-disabled-fg); cursor:not-allowed; filter: grayscale(.15) opacity(.85);
    animation:none !important; background-position:50% 50%;
  }

  /* Focus 可访问性 */
  body:has(#typora-sidebar.active-tab-files.use-file-list-style)
  ul#file-menu li > a[role="menuitem"]:focus-visible{
    outline:2px solid var(--fm-focus-ring); outline-offset:2px;
  }

  /* 右侧快捷键 & 图标/分隔线 */
  body:has(#typora-sidebar.active-tab-files.use-file-list-style)
  ul#file-menu .ty-menu-shortcut{
    float:right; color:var(--fm-shortcut-fg);
    margin-left:1.25rem; font-size:.92em; letter-spacing:.02em;
  }

  /* 图标范围仅限“菜单项内部后代”，避免渗透 */
  body:has(#typora-sidebar.active-tab-files.use-file-list-style)
  ul#file-menu li > a[role="menuitem"] :is(.ty-icon, .fa, .ion){ color: currentColor; }

  /* 分隔线不拦截点击 */
  body:has(#typora-sidebar.active-tab-files.use-file-list-style)
  ul#file-menu li.divider{
    height:1px; margin:4px 0; background:var(--fm-divider); pointer-events:none;
  }

  /* 关键帧（名称与 Tree 版一致，便于复用工具链） */
  @keyframes catalystTabFlow--filemenu{
    0%{background-position:0% 50%}
    50%{background-position:100% 50%}
    100%{background-position:0% 50%}
  }

  /* 降动态偏好 */
  @media (prefers-reduced-motion: reduce){
    body:has(#typora-sidebar.active-tab-files.use-file-list-style)
    ul#file-menu li > a[role="menuitem"]:hover{
      animation:none !important; background-position:50% 50%;
    }
  }
}
/* =============================== END OF PACKAGE ============================ */
